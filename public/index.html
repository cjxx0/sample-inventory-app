<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Inventory</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css">
</head>
<body>
    <div class="container">
        <h1 class="mt-5">Product Inventory</h1>

        <form id="productForm" class="mb-5">
            <div class="mb-3">
                <label for="name" class="form-label">Product Name</label>
                <input type="text" class="form-control" id="name" name="name" required>
            </div>
            <div class="mb-3">
                <label for="description" class="form-label">Product Description</label>
                <input type="text" class="form-control" id="description" name="description" required>
            </div>
            <div class="mb-3">
                <label for="type" class="form-label">Product Type</label>
                <select class="form-select" id="type" name="type" required>
                    <option value="food">Food</option>
                    <option value="sports">Sports</option>
                    <option value="household">Household</option>
                    <option value="music">Music</option>
                    <option value="electronic">Electronic</option>
                    <option value="appliance">Appliance</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="quantity" class="form-label">Product Quantity</label>
                <input type="number" class="form-control" id="quantity" name="quantity" required>
            </div>
            <div class="mb-3">
                <label for="price" class="form-label">Unit Price</label>
                <input type="number" class="form-control" id="price" name="price" step="0.01" required>
            </div>
            <button type="submit" class="btn btn-primary">Add Product</button>
        </form>

        <h2>Product List</h2>
        <table class="table">
          <thead>
              <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Description</th>
                  <th>Type</th>
                  <th>Quantity</th>
                  <th>Price</th>
                  <th>Actions</th>
              </tr>
          </thead>
          <tbody id="productTableBody">
              <!-- Products will be dynamically inserted here -->
          </tbody>
        </table>
    </div>

    <script>
      let editProductId = null;
  
      function loadProducts() {
          fetch('/v1/products')
              .then(response => response.json())
              .then(data => {
                  const tableBody = document.getElementById('productTableBody');
                  tableBody.innerHTML = ''; // Clear the table body
                  data.forEach(product => {
                      const row = document.createElement('tr');
                      row.innerHTML = `
                          <td>${product.id}</td>
                          <td>${product.name}</td>
                          <td>${product.description}</td>
                          <td>${product.type}</td>
                          <td>${product.quantity}</td>
                          <td>${product.price.toFixed(2)}</td>
                          <td>
                              <button class="btn btn-warning btn-sm" onclick="editProduct(${product.id})">Edit</button>
                              <button class="btn btn-danger btn-sm" onclick="deleteProduct(${product.id})">Delete</button>
                          </td>
                      `;
                      tableBody.appendChild(row);
                  });
              })
              .catch(err => console.error('Error loading products:', err));
      }
  
      function editProduct(id) {
          fetch(`/v1/products`)
              .then(response => response.json())
              .then(data => {
                  const product = data.find(p => p.id === id);
                  if (product) {
                      document.getElementById('name').value = product.name;
                      document.getElementById('description').value = product.description;
                      document.getElementById('type').value = product.type;
                      document.getElementById('quantity').value = product.quantity;
                      document.getElementById('price').value = product.price;
                      editProductId = product.id; // Store the product ID for editing
                  }
              })
              .catch(err => console.error('Error loading product:', err));
      }
  
      function deleteProduct(id) {
          fetch(`/v1/product/${id}`, {
              method: 'DELETE'
          })
          .then(response => {
              if (response.ok) {
                  loadProducts(); // Reload the products after deletion
              } else {
                  console.error('Error deleting product:', response.statusText);
              }
          });
      }
  
      document.getElementById('productForm').addEventListener('submit', function(event) {
          event.preventDefault(); // Prevent default form submission
  
          const formData = new FormData(this);
          const data = Object.fromEntries(formData);
          const method = editProductId ? 'PUT' : 'POST'; // Use PUT for editing, POST for adding
  
          fetch(`/v1/product${editProductId ? '/' + editProductId : ''}`, {
              method: method,
              headers: {
                  'Content-Type': 'application/x-www-form-urlencoded',
              },
              body: new URLSearchParams(data),
          })
          .then(response => {
              if (response.ok) {
                  this.reset(); // Reset the form
                  editProductId = null; // Clear edit product ID
                  loadProducts(); // Reload the products
              } else {
                  console.error('Error saving product:', response.statusText);
              }
          });
      });
  
      // Load products on initial page load
      window.onload = loadProducts;
  </script>
</body>
</html>
